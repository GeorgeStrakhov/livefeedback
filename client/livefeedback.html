<head>
  <title>LiveFeedBack.mobi - get live feedback from any audience</title>
</head>

<body>
  {{> app}}
</body>

<template name="app">
  {{#if urlPart}} <!-- if there the url is something glike http://livefeedback.mobi/streams/id-->
    {{> singleStream}}
  {{else}}
    {{#if currentUser}} <!-- currentUser is one of the default helpers in Meteor-->
      {{> myStreams}}
    {{else}}
      {{> welcome}}
    {{/if}}
  {{/if}}
</template>

<template name="welcome">
  welcome screen under construction...
  {{loginButtons}}
</template>

<template name="myStreams">
  <div>
    {{loginButtons}}
  </div>
  <div>
    <h1>Here are your streams:</h1>
  </div>
  <div>
    <ul>
      {{#if noStreamsYet}}
        <li>looks like you haven't created any streams yet...</li>
      {{/if}}
      {{#each allStreams}}
        {{> singleStreamItem}}
      {{/each}}
    </ul>
  </div>
  <div>
    <button class="btn" id="createNewStream">create new</button>
    <div class="hide" id="newStreamCreate">
      <input type="text" id="newStreamName" placeholder="Your stream name!" />
      <button class="btn" id="createNewStreamBtn">ok</button>
    </div>
    <button class="btn" id="joinStream">go to stream</button>
    <div class="hide" id="joinStreamForm">
      <input type="text" id="joinStreamName" placeholder="please enter a name of the stream"/>
      <button class="btn" id="joinStreamBtn">go</btn>
    </div>
  </div>
</template>

<template name="singleStreamItem">
  <li class="thisStream{{this.status}}"><a href="#stream/{{this._id}}">{{this.name}}</a> - joiners: <a href="#" class="joinersForStream" id="joinersCountForStream{{this._id}}" rel="popover" data-placement="right" data-title="People who joined:" data-content="{{namesOfPeopleWhoJoined}}">{{joinersCount}}</a></li>
</template>

<template name="singleStream">
  {{#if currentStream._id}} <!-- if such a stream exists -->
    {{#if currentUser}}
      {{#if myOwnStream}}
        {{> ownerView}}
      {{else}}
        {{> participantView}}
      {{/if}}
    {{else}}
      {{> signIn}}
    {{/if}}
  {{else}}
    {{> page404}}
  {{/if}}
</template>

<template name="page404">
  404, no such stream exists
</template>

<template name="signIn">
  <h1>Hello!</h1>
  <p>In order to provide your live feedback to the stream called "{{currentStream.name}}", please {{loginButtons}} </p>
  <p>this live feedback is powered by <a href="http://livefeedback.mobi" target="_blank">LiveFeedback.mobi</a></p>
</template>

<template name="ownerView">
  <div class="container">
    <h3>Stream points</h3>
    <ul class="points span4 clearfix">
      {{#each currentStream.points}}
        <li class="{{#if this.isActive}}active {{/if}}point">
          {{> singlePointTemplate}}
          <div class="btn-group pull-right">
            <button class="edit btn btn-mini">edit</button>
            <button class="delete btn btn-danger btn-mini">delete</button>
            <button class="makeActive btn btn-success btn-mini">activate</button>
          </div>
        </li>
      {{/each}}
      <li>
        <textarea type="text" id="newPointContent" placeholder="type any HTML and be happy" class="span4 inputNewPoint"/>
        <div class="btn-group">
          <button class="btn span2" id="newPointBtn">add</button>
          <button class="btn span2" id="newPointBtnAndActivate">add and make active</button>          
        </div>
      </li>
    </ul>
  </div>
</template>

<template name="singlePointTemplate">
  <span class="label label-success">{{allThumbsUp}}</span>
  <span class="label label-important">{{allThumbsDown}}</span>
  <span class="content">{{{this.content}}}</span>
</template>

<template name="participantView">
  {{#if currentStreamStatus "finished"}}
    {{> finishedStreamView}}
  {{/if}}
  {{#if currentStreamStatus "active"}}
    {{#if activePoint "true"}}
      {{#if hasVoted "true"}}
        <div>
          <div style="text-align: center">{{{activePoint.content}}}</div>
          <div><strong>results:</strong></div>
          <div>Thumbs Up: {{currentPointVotes "Up"}}</div>
          <div>Thumbs Down: {{currentPointVotes "Down"}} </div>
        </div>
        <div id="pointFeedback">
          <br/>
          <input type="text" id="pointFeedbackText" placeholder="Type feedback here" />
          <button class="btn" id="pointFeedbackButton">Submit</button>
        </div>
      {{else}}
        <button id="voteUp" class=" btn-large btn-block btn-primary" type="button">Vote Up</button>
        <div style="text-align: center">{{{activePoint.content}}}</div>
        <button id="voteDown" class="btn btn-large btn-block btn-danger" type="button">Vote Down</button>
      {{/if}}
    {{else}}
      <div>no active point</div>
    {{/if}}
  {{/if}}
</template>

<template name="participantViewVote">
</template>
<template name="participantViewResults">
</template>

<template name="finishedStreamView">
  finished stream ciew under coonstruction...
</template>
